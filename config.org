#+PROPERTY: header-args :results silent

* Some defaults
  #+BEGIN_SRC emacs-lisp
(menu-bar-mode 1) ;; show menu: useful things there some times!
(tool-bar-mode 0) ;; toolbar definetly not
(scroll-bar-mode 0) ;; hide system scrollbars

;; CUA
(cua-mode 0) ;; ctrl-c ctrl-v copy paste etc
(global-set-key (kbd "C-v") 'yank)

(global-hl-line-mode 1) ;; Highlight current line
(fset 'yes-or-no-p 'y-or-n-p)
;;(define-key cua-global-keymap [C-return] nil) ;; don't remember the use-case of this
;;(define-key cua--cua-keys-keymap [C-z] nil)
(global-visual-line-mode 1) ;; word/line wrap
(winner-mode t) ;; C-c left will undo window position changes
(setq ring-bell-function 'ignore)
(global-display-line-numbers-mode 1)
(setq inhibit-startup-screen 1)
(delete-selection-mode 1) ;; delete selected region if starting typing

;; Keeping clipboard data before replacing it with emacs copy/kill etc
(setq save-interprogram-paste-before-kill t)
  #+END_SRC

** functions
   #+BEGIN_SRC emacs-lisp
(defun indent-buffer ()
  (interactive)
  (save-excursion
    (indent-region (point-min) (point-max) nil)))

(defun toggle-comment-on-line ()
  "comment or uncomment current line"
  (interactive)
  (comment-or-uncomment-region (line-beginning-position) (line-end-position))
  )
   #+END_SRC
** bindings
   #+BEGIN_SRC emacs-lisp
(global-set-key (kbd "C-/") 'toggle-comment-on-line)
(global-set-key (kbd "C-?") 'comment-or-uncomment-region)
   #+END_SRC
* Package source, use-package etc
  #+BEGIN_SRC emacs-lisp
(setq package-enable-at-startup nil)

(setq package-archives '(("gnu" . "https://elpa.gnu.org/packages/")
                         ("melpa" . "https://melpa.org/packages/")
			 ("org" . "https://orgmode.org/elpa/")))
  #+END_SRC

** use-package
   Bootstrapping use-package
   #+BEGIN_SRC emacs-lisp
(unless (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))
   #+END_SRC
** COMMENT quelpa (for github sources)
   #+BEGIN_SRC emacs-lisp
(setq quelpa-update-melpa-p nil)
;;     (setq quelpa-checkout-melpa-p nil)
(use-package quelpa
  :ensure t
  :config)


;;     (package-initialize)
;; (if (require 'quelpa nil t)
;;     (quelpa-self-upgrade)
;;   (with-temp-buffer
;;     (url-insert-file-contents "https://framagit.org/steckerhalter/quelpa/raw/master/bootstrap.el")
;;     (eval-buffer)))

   #+END_SRC

** straight.el
   see
   + https://github.crookster.org/switching-to-straight.el-from-emacs-26-builtin-package.el/
   + https://github.com/raxod502/straight.el/blob/develop/README.md#getting-started

   #+BEGIN_SRC emacs-lisp
(defvar bootstrap-version)
(let ((bootstrap-file
       (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
      (bootstrap-version 5))
  (unless (file-exists-p bootstrap-file)
    (with-current-buffer
	(url-retrieve-synchronously
	 "https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"
	 'silent 'inhibit-cookies)
      (goto-char (point-max))
      (eval-print-last-sexp)))
  (load bootstrap-file nil 'nomessage))

(setq straight-use-package-by-default nil)
   #+END_SRC
* Org customizations
  #+BEGIN_SRC emacs-lisp
(global-set-key (kbd "M-n") 'outline-next-visible-heading)
(global-set-key (kbd "M-p") 'outline-previous-visible-heading)
;; org-src-fontify-natively t
(setq org-src-preserve-indentation t)
  #+END_SRC
** babel languages
   #+BEGIN_SRC emacs-lisp
(org-babel-do-load-languages 'org-babel-load-languages
			     '(
			       (shell . t)
			       ;;	  (python . t)
			       ;;	  (sql . t)
			       ;;	  (python . t)
			       ;;	  (restclient . t)
			       ;;	  (php . t)
			       ;;	  (clojure . t)
			       )
			     )
   #+END_SRC

** COMMENT quelpa eval-in-repl : github forks
   #+BEGIN_SRC emacs-lisp
(quelpa '(eval-in-repl
	  :repo "actondev/eval-in-repl" :fetcher github
	  :branch "feature/multiple_sh_sessions"))

(quelpa '(org-babel-eval-in-repl
	  :repo "actondev/org-babel-eval-in-repl" :fetcher github
	  :branch "feature/multiple_sh_sessions"))

(use-package eval-in-repl
  :ensure t)

(use-package org-babel-eval-in-repl
  :ensure t
  :bind
  (:map org-mode-map
	("C-<return>" . ober-eval-in-repl) ))
   #+END_SRC

** eval in repl
   Making use of straight.el to use my forks
   #+BEGIN_SRC emacs-lisp
(use-package eval-in-repl
  :straight
  (:type git :host github :repo "kaz-yos/eval-in-repl"
	 :fork (:host github :repo "actondev/eval-in-repl" :branch "feature/multiple_sh_sessions"))
  )

(use-package org-babel-eval-in-repl
  :straight
  (:type git :host github :repo "diadochos/org-babel-eval-in-repl"
	 :fork (:host github :repo "actondev/org-babel-eval-in-repl" :branch "feature/multiple_sh_sessions"))
  :bind
  (:map org-mode-map
	("C-<return>" . ober-eval-in-repl)))
   #+END_SRC
* Helm
  #+BEGIN_SRC emacs-lisp
(use-package helm
  :ensure t
  :bind(
	("M-x" . helm-M-x)
	("C-<tab>" . helm-mini)
	("C-x C-f" . helm-find-files)
	("C-S-v" . helm-show-kill-ring)
	:map helm-map
	("<tab>" . helm-execute-persistent-action)
	("<left>" . left-char)
	("<right>" . right-char)
	)
  :init
  (require 'helm-config)
  :config
  (setq helm-M-x-fuzzy-match t
	helm-recentf-fuzzy-match t
	helm-apropos-fuzzy-match t
	helm-buffers-fuzzy-matching t
	helm-completion-in-region-fuzzy-match t
	helm-mode-fuzzy-match t)
  ;; disable auto input
  (setq helm-swoop-pre-input-function
	(lambda () nil))
  (helm-mode 1)
	)

(use-package helm-swoop
  :ensure t
  :config
  (setq helm-swoop-use-fuzzy-match nil)
  (setq helm-swoop-speed-or-color t)
  (setq helm-autoresize-max-height 35)
  (setq helm-autoresize-min-height 20)
  (helm-autoresize-mode)
  )

(use-package helm-ag
  :ensure t)
  #+END_SRC

** installing ag (used in helm-ag)
   In ubuntu:
   #+BEGIN_SRC sh
sudo apt-get install silversearcher-ag
   #+END_SRC
* Rainbow
  rainbow-delimiters help everytime :)
  #+BEGIN_SRC emacs-lisp
(use-package rainbow-delimiters
  :ensure t
  :config
  (add-hook 'prog-mode-hook #'rainbow-delimiters-mode)
  )
  #+END_SRC
* Window management
** Resizing (windresize)
   #+BEGIN_SRC emacs-lisp
(use-package windresize
  :ensure t
  :config
  (setq windresize-default-increment 5)
  )
   #+END_SRC

** ace-window
   #+BEGIN_SRC emacs-lisp
(use-package ace-window
  :ensure t
  :config
  (global-set-key (kbd "M-o") 'ace-window)
  )
   #+END_SRC

* Project management

** Projectile & neotree
   Useful neotree shortcuts
   + =A= : stretch toggle
   + =U= : go up to parent
   + =C-c C-a= : collapse all

   #+BEGIN_SRC emacs-lisp
(use-package projectile
  :ensure t
  :config
  (projectile-mode 1)
  )
(use-package helm-projectile
  :ensure t
  )

(defun display-line-numbers-disable-hook (_)
  "Disable display-line-numbers locally."
  (display-line-numbers-mode -1))

(use-package neotree
  :ensure t
  :config
  (setq neo-smart-open t)
  (add-hook 'neo-after-create-hook 'display-line-numbers-disable-hook)

  :bind(
	("<f8>" . neotree-toggle)
	)
  )
   #+END_SRC
* Appearance
** COMMENT monokai
   #+BEGIN_SRC emacs-lisp
(use-package monokai-theme
  :ensure t)

;; (use-package sublime-themes
;;   :ensure t
;;   :config
;;   (load-theme 'spolsky t)
;;   )
   #+END_SRC
** doom
   #+BEGIN_SRC emacs-lisp
(use-package doom-themes
  :ensure t
  :config
  (load-theme 'doom-molokai t)
  (doom-themes-visual-bell-config)
  (doom-themes-neotree-config)
  ;; (setq doom-themes-neotree-file-icons t)
)
   #+END_SRC
** COMMENT powerline
   #+BEGIN_SRC emacs-lisp
(use-package powerline
  :ensure t
  :config
  (powerline-default-theme))
   #+END_SRC
** doom-modeline
   #+BEGIN_SRC emacs-lisp
(use-package doom-modeline
      :ensure t
      :hook (after-init . doom-modeline-mode))
   #+END_SRC

   Note: after you have to run =all-the-icons-install-fonts= with M-x.
*** minions: showing minor modes
    #+BEGIN_SRC emacs-lisp
(use-package minions
  :config
  (minions-mode 1)
  (setq doom-modeline-minor-modes (featurep 'minions)))
    #+END_SRC

** highlighting matching tag (show-paren)
   #+BEGIN_SRC emacs-lisp
(require 'paren)
(set-face-attribute 'show-paren-match nil
		    :box '(:line-width -1 :color "#ccc")
		    :foreground nil
		    :weight 'normal)
(show-paren-mode 1) ;; has to be called after set-face-attribute?
   #+END_SRC
* Welcome screen
  #+BEGIN_SRC emacs-lisp
(use-package dashboard
  :ensure t
  :diminish dashboard-mode
  :config
  ;;  (setq dashboard-banner-logo-title "your custom text")
  (setq dashboard-startup-banner 1) ;; integer is for text
  (setq dashboard-items '(
			  (projects . 10)
                          (bookmarks . 10)
			  (recents  . 10)
			  ))
  (dashboard-setup-startup-hook))
  #+END_SRC
* editing etc
** selection
   #+BEGIN_SRC emacs-lisp
;; usecase: select the block (enclosed by parenthesis).. expand -> wrap around the outter block
(use-package expand-region
  :ensure t
  )

(use-package multiple-cursors
  :ensure t
  :config
  (global-set-key (kbd "C->") 'mc/mark-next-like-this-word)
  (global-set-key (kbd "C-<") 'mc/mark-previous-like-this-word)
  (global-set-key (kbd "M-<f3>") 'mc/mark-all-like-this) ;; submlime like
  (global-set-key (kbd "C-S-<mouse-1>") 'mc/add-cursor-on-click)
  )
   #+END_SRC
** undo
   #+BEGIN_SRC emacs-lisp
(use-package undo-tree
  :ensure t
  :config
  (global-undo-tree-mode 1)
  (unbind-key "C-/" undo-tree-map)
  (unbind-key "C-?" undo-tree-map)
  :bind(
	("M-/" . undo-tree-visualize)
	("C-z" . undo-tree-undo)
	("C-S-z" . undo-tree-redo)
	)
  )
   #+END_SRC
** Working with lisps
*** paredit
    #+BEGIN_SRC emacs-lisp
(use-package paredit
  :ensure t
  ;; <C-right>	paredit-forward-slurp-sexp
  ;; <C-left>	paredit-forward-barf-sexp
  ;; <C-M-right>	paredit-backward-barf-sexp
  ;; <C-M-left>	paredit-backward-slurp-sexp
  :config
  (unbind-key "C-<right>" paredit-mode-map)
  (unbind-key "C-<left>" paredit-mode-map)
  :bind(
	:map paredit-mode-map
	("M-]" . paredit-forward-slurp-sexp) ;; c ->
	("M-[" . paredit-forward-barf-sexp) ;; c <-
	("M-}" . paredit-backward-barf-sexp) ;; C-M >
	("M-{" . paredit-backward-slurp-sexp) ;; C M <
	)
  )
    #+END_SRC
*** COMMENT parinfer
    #+BEGIN_SRC emacs-lisp
(defun add-parinfer-hooks ()
  (add-hook 'clojure-mode-hook #'parinfer-mode)
  (add-hook 'emacs-lisp-mode-hook #'parinfer-mode)
  (add-hook 'common-lisp-mode-hook #'parinfer-mode)
  (add-hook 'scheme-mode-hook #'parinfer-mode)
  (add-hook 'lisp-mode-hook #'parinfer-mode))

(use-package parinfer
  :ensure t
  :bind
  (("C-," . parinfer-toggle-mode))
  :init
  (progn
    (setq parinfer-extensions
          '(
	    defaults       ; should be included.
            ;; pretty-parens  ; different paren styles for different modes.
            ;; evil           ; If you use Evil.
            ;; lispy          ; If you use Lispy. With this extension, you should install Lispy and do not enable lispy-mode directly.
            paredit        ; Introduce some paredit commands.
            smart-tab      ; C-b & C-f jump positions and smart shift with tab & S-tab.
            smart-yank
	    ))   ; Yank behavior depend on mode.
    ))
    #+END_SRC
*** aggresive indent?
    https://github.com/Malabarba/aggressive-indent-mode
    vs electric
    #+BEGIN_SRC emacs-lisp
(defun add-aggressive-indent-mode-hooks ()
  (add-hook 'clojure-mode-hook #'aggressive-indent-mode)
  (add-hook 'emacs-lisp-mode-hook #'aggressive-indent-mode)
  ;; (add-hook 'common-lisp-mode-hook #'aggressive-indent-mode)
  ;; (add-hook 'scheme-mode-hook #'aggressive-indent-mode)
  ;; (add-hook 'lisp-mode-hook #'aggressive-indent-mode)
  )

(use-package aggressive-indent
  :ensure t
  :config
  (add-aggressive-indent-mode-hooks)
  )
    #+END_SRC
** jumping around (ace jump)

   #+BEGIN_SRC emacs-lisp
(use-package ace-jump-mode
  :ensure t
  )
   #+END_SRC

* (Ma)git
  #+BEGIN_SRC emacs-lisp
(use-package magit
  :ensure t
  :config
  (setq ediff-split-window-function 'split-window-horizontally)
  (setq ediff-window-setup-function 'ediff-setup-windows-plain)
  )
  #+END_SRC
* Languages
** Clojure
   #+BEGIN_SRC emacs-lisp
(use-package clojure-mode
  :ensure t
  :bind(
	:map clojure-mode-map
	("C-<return>" . cider-eval-defun-at-point)
	("M-<return>" . cider-eval-last-sexp)
	)
  )

(use-package cider
  :ensure t)
   #+END_SRC

** etc (yaml..)
   #+BEGIN_SRC emacs-lisp
(use-package yaml-mode
  :ensure t)
   #+END_SRC

* Key-chord
  #+BEGIN_SRC emacs-lisp
(defun key-chord-helm ()
  ;; helm: , (right hand middle finger)
  (key-chord-define-global ",r" 'helm-all-mark-rings) ;; Rings
  (key-chord-define-global ",m" 'helm-mini) ;; Mini
  (key-chord-define-global ",s" 'helm-swoop) ;; Swoop
  (key-chord-define-global ",t" 'helm-projectile-find-file) ;; projecTile
  (key-chord-define-global ",g" 'helm-projectile-ag) ;; aG
  )

(defun key-chord-ace-jump ()
  ;; ace: c (c for jump : left hand middle finger)
  (key-chord-define-global "cj" 'ace-jump-mode)
  ;; Jump Character
  (key-chord-define-global "ck" 'ace-jump-char-mode)
  ;; Jump Line
  (key-chord-define-global "cl" 'ace-jump-line-mode)
  )

(defun key-chord-windows-management ()
  ;; move between windows -WASD- like movement, except for the right hand
  ;; using ;
  (key-chord-define-global ";w" 'windmove-up)
  (key-chord-define-global ";a" 'windmove-left)
  (key-chord-define-global ";s" 'windmove-down)
  (key-chord-define-global ";d" 'windmove-right)

  ;; windows
  (key-chord-define-global ";q" 'delete-window) ;;q Quit
  (key-chord-define-global ";e" 'delete-other-windows)
  (key-chord-define-global ";f" (lambda () (interactive)(split-window-horizontally) (other-window 1))) ;; f home row
  (key-chord-define-global ";v" (lambda () (interactive)(split-window-vertically) (other-window 1))) ;; Vertical

  (key-chord-define-global ";r" 'windresize) ;; Resize
  )

(defun key-chord-editing ()
  ;; Expand Region (r for region)
  (key-chord-define-global "rj" 'er/expand-region)
  )

(use-package key-chord
  :ensure t
  :config
  ;; disable in mini buffers
  (setq key-chord-two-keys-delay .05
	key-chord-one-key-delay .1)
  (defun disable-key-chord-mode ()
    (set (make-local-variable 'input-method-function) nil))

  (add-hook 'minibuffer-setup-hook #'disable-key-chord-mode)
  (key-chord-mode 1)

  (key-chord-helm)
  (key-chord-windows-management)
  (key-chord-editing)
  (key-chord-ace-jump)
  )
  #+END_SRC

* Presentation? (command-log)
  #+BEGIN_SRC emacs-lisp
(use-package command-log-mode
  :ensure t)
  #+END_SRC
* COMMENT notes
  #+BEGIN_SRC emacs-lisp
;; customize inital screen
(customize-group 'initialization)
  #+END_SRC
** cua mode

   #+BEGIN_SRC text
`cua--ena-cua-keys-keymap' Minor Mode Bindings:
key             binding
---             -------

C-c		Prefix Command
C-v		yank
C-x		Prefix Command
C-z		undo
ESC		Prefix Command

M-v		delete-selection-repeat-replace-region

C-c <timeout>	copy-region-as-kill

C-x <timeout>	kill-region   
   #+END_SRC
** org sh sessions example
   #+BEGIN_SRC sh :session *sh1*
echo hi
echo hi2
   #+END_SRC

   #+BEGIN_SRC sh :session *sh2*
echo "hi from sh2"
echo hi2
   #+END_SRC
* TODO magit, ace jump, projectile (neotree..?), start screen
   + https://emacs.stackexchange.com/questions/14282/replace-splash-screen-with-list-of-recentf
